---
title: '[Kubernetes 심층 탐구 2부] 워커 노드의 모든 것'
date: 2025-08-24 09:00:00 +0900
categories:
- server
- kubernetes
tags:
- kubernetes
- worker-node
- kubelet
- kube-proxy
- cri
- cni
author_profile: true
sidebar:
  nav: docs
toc: true
toc_sticky: true
---

## 서론

안녕하세요. 'Kubernetes 심층 탐구' 시리즈의 두 번째 시간입니다. 1부에서는 클러스터의 두뇌인 컨트롤 플레인을 살펴보았고, 이번에는 컨트롤 플레인의 지시를 받아 실제 컨테이너를 실행하고 관리하는 일꾼, **워커 노드(Worker Node)**의 구성 요소들을 낱낱이 파헤쳐 보겠습니다. `kubelet`, `kube-proxy`, 그리고 컨테이너를 둘러싼 표준 인터페이스인 CRI와 CNI까지, 워커 노드의 모든 것을 알아보겠습니다.

## 1. `kubelet`: 노드의 충실한 관리자

`kubelet`은 각 워커 노드에서 실행되는 가장 중요한 에이전트입니다. 컨트롤 플레인과 통신하며 파드의 생명주기를 전적으로 책임집니다.

### 파드 생명주기 관리

`kubelet`의 핵심 임무는 자신에게 할당된 파드들이 명세(`.spec`)에 정의된 대로 건강하게 실행되도록 보장하는 것입니다.

1.  **파드 할당 감지**: `kubelet`은 API 서버를 계속 지켜보다가(`watch`), `kube-scheduler`에 의해 자신에게 새로운 파드가 할당되면 이를 즉시 인지합니다.
2.  **CRI를 통한 컨테이너 생성**: `kubelet`은 파드 명세에 정의된 컨테이너들을 실행하기 위해 CRI(Container Runtime Interface)를 통해 컨테이너 런타임(`containerd` 등)에게 컨테이너 생성을 요청합니다. 이 과정에는 다음이 포함됩니다.
    -   컨테이너 이미지 다운로드
    -   볼륨(Volume) 마운트
    -   네트워크 설정 (CNI 호출)
    -   컨테이너 시작
3.  **상태 보고**: `kubelet`은 파드와 컨테이너의 상태를 주기적으로 API 서버에 보고하여 `etcd`에 저장된 클러스터의 현재 상태를 최신으로 유지합니다.

### 상태 점검 (Probes)

`kubelet`은 파드 안의 애플리케이션이 정말로 정상인지 확인하기 위해 세 가지 종류의 프로브(Probe)를 사용합니다.

-   **`livenessProbe` (생존 프로브)**: "애플리케이션이 살아있는가?"를 확인합니다. 이 프로브가 실패하면, `kubelet`은 컨테이너가 응답 없는 상태(deadlock 등)라고 판단하고 해당 컨테이너를 **재시작**합니다.
-   **`readinessProbe` (준비 프로브)**: "애플리케이션이 트래픽을 받을 준비가 되었는가?"를 확인합니다. 이 프로브가 실패하면, `kubelet`은 컨테이너가 아직 시작 중이거나 바쁜 상태라고 판단하고, 해당 파드를 서비스(Service)의 엔드포인트에서 **제외**합니다. 트래픽이 전달되지 않으므로, 무중단 배포에 필수적입니다.
-   **`startupProbe` (시작 프로브)**: 시작하는 데 시간이 오래 걸리는 애플리케이션을 위한 프로브입니다. 이 프로브가 성공할 때까지 `livenessProbe`와 `readinessProbe`는 시작되지 않습니다. 시작 시간이 긴 애플리케이션이 `livenessProbe`에 의해 성급하게 재시작되는 것을 방지합니다.

### Static Pods

`kubelet`은 API 서버 없이도 파드를 실행할 수 있는 기능을 제공하는데, 이를 **Static Pod**라고 합니다. 특정 디렉토리(`/etc/kubernetes/manifests`)에 파드 정의 YAML 파일을 넣어두면, `kubelet`이 이를 감지하여 직접 파드를 실행합니다. 컨트롤 플레인 컴포넌트(`kube-apiserver`, `etcd` 등) 자체를 파드로 실행하는 `kubeadm` 방식이 바로 이 Static Pod를 활용한 것입니다.

## 2. `kube-proxy`: 클러스터 네트워킹의 마법사

`kube-proxy`는 클러스터의 `Service` 개념을 실제 네트워크 규칙으로 변환하는 역할을 합니다. 파드들은 언제든지 생성되고 사라질 수 있어 IP가 계속 바뀌지만, `Service`의 고정된 가상 IP(ClusterIP)로 애플리케이션에 안정적으로 접근할 수 있는 것은 바로 `kube-proxy` 덕분입니다.

### 동작 모드별 상세 분석

`kube-proxy`는 여러 동작 모드를 가지며, 각각 장단점이 있습니다.

-   **`iptables` 모드 (기본값)**
    -   **동작 방식**: `kube-proxy`는 API 서버를 감시하며 `Service`와 `EndpointSlice`의 변경 사항을 인지합니다. 그리고 각 `Service`에 대해 `iptables` 규칙을 생성합니다. 예를 들어, `Service A` (ClusterIP `10.96.0.10`)가 `Pod 1` (`192.168.1.5`), `Pod 2` (`192.168.1.6`)를 가리킨다면, `10.96.0.10`으로 들어오는 트래픽을 두 파드의 IP로 무작위로 DNAT(Destination NAT)하는 규칙을 만듭니다.
    -   **장점**: 매우 안정적이고 널리 사용됩니다.
    -   **단점**: 서비스와 파드의 수가 수천 개 이상으로 늘어나면 `iptables` 규칙이 너무 많아져 성능이 저하될 수 있습니다.

-   **`IPVS` (IP Virtual Server) 모드**
    -   **동작 방식**: `IPVS`는 리눅스 커널에 내장된 고성능 로드 밸런서입니다. `kube-proxy`는 `iptables` 대신 `IPVS` 규칙을 사용하여 서비스 트래픽을 관리합니다. `IPVS`는 해시 테이블을 사용하여 대량의 규칙을 `iptables`보다 훨씬 효율적으로 처리합니다.
    -   **장점**: 대규모 클러스터에서 `iptables` 모드보다 훨씬 뛰어난 성능과 낮은 지연 시간을 제공합니다. 다양한 로드 밸런싱 알고리즘(round-robin, least-connection 등)을 지원합니다.
    -   **단점**: `IPVS`가 커널에 내장되어 있어야 사용 가능합니다.

## 3. CRI 와 CNI: 표준화된 인터페이스

쿠버네티스는 특정 기술에 종속되지 않고 유연하게 확장할 수 있도록 다양한 인터페이스를 정의합니다. 워커 노드에서는 CRI와 CNI가 가장 중요합니다.

### CRI (Container Runtime Interface)

**CRI**는 `kubelet`과 컨테이너 런타임 간의 통신을 위한 API 명세입니다. 과거에는 `kubelet`이 Docker에 강하게 의존했지만, CRI의 등장으로 `kubelet`은 CRI 표준만 만족하면 어떤 컨테이너 런타임이든 사용할 수 있게 되었습니다.

-   **주요 런타임**:
    -   **`containerd`**: Docker에서 분리되어 나와 CNCF에 기증된 프로젝트로, 현재 사실상의 표준 런타임입니다.
    -   **`CRI-O`**: 쿠버네티스를 위해 경량으로 만들어진 런타임입니다.
-   **동작 흐름**: `kubelet`이 "이 이미지로 컨테이너를 시작해줘"라고 CRI를 통해 요청하면, `containerd`와 같은 런타임이 그 요청을 받아 실제 컨테이너를 실행합니다.

### CNI (Container Networking Interface)

**CNI**는 컨테이너의 네트워크 인터페이스를 설정하기 위한 표준입니다. `kubelet`이 파드를 위한 네트워크 네임스페이스를 생성한 뒤, CNI 플러그인을 호출하여 네트워크 인터페이스 생성, IP 주소 할당, 라우팅 규칙 설정 등을 위임합니다.

-   **주요 CNI 플러그인**:
    -   **Overlay Network 방식**: 각 노드에 가상의 네트워크를 만들고, 노드 간 통신은 원래의 물리적 네트워크를 통해 터널링(VXLAN 등)합니다.
        -   **예**: Flannel, Weave Net
        -   **장점**: 기존 네트워크 인프라를 변경할 필요 없이 쉽게 구성할 수 있습니다.
    -   **Routed Network 방식**: CNI 플러그인이 라우팅 프로토콜(BGP 등)을 사용하여 파드 IP를 물리적 네트워크에 직접 광고합니다.
        -   **예**: Calico, Cilium
        -   **장점**: 터널링 오버헤드가 없어 네트워크 성능이 우수합니다. 세밀한 네트워크 정책(NetworkPolicy) 적용에 강점을 가집니다.

## 결론

워커 노드는 `kubelet`이라는 현장 관리자의 지휘 아래, `kube-proxy`가 닦아놓은 길을 통해 통신하고, CRI와 CNI라는 표준화된 도구를 사용하여 컨테이너를 실행하고 네트워킹하는, 쿠버네티스의 실제 작업 공간입니다. 이 구성 요소들의 긴밀한 협력 덕분에 우리는 수많은 컨테이너들을 안정적으로 운영할 수 있습니다.

다음 3부에서는 이 모든 컴포넌트들을 어떻게 하면 쉽고 안정적으로 설치할 수 있는지, **Kubespray**의 세계를 탐험해 보겠습니다.
